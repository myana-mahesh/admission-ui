<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/html-header :: common_head"></head>
<body class="theme-light has-sidebar">

  <!-- Left sidebar -->
  <div th:replace="fragments/sidebar :: app_sidebar(active='students')"></div>

  <!-- Content wrapper -->
  <div class="app-main-wrap">
    <div class="container-xl py-3 max-width-100">

      <!-- Header -->
      <div class="d-flex align-items-center justify-content-between mb-3">
        <div>
          <h3 class="mb-0">Students</h3>
        </div>
      </div>

      <!-- Filters / Toolbar -->
      <form class="row g-2 align-items-end justify-content-between mb-3"
            method="get" th:action="@{/studentlist}">
        <!-- keyword search -->
        <div class="col-md-6">
          <label class="form-label">Search</label>
          <input type="text"
                 class="form-control"
                 name="q"
                 placeholder="ABS ID / Student name / Mobile / Email"
                 th:value="${q}">
        </div>

        <!-- page size -->
        <div class="col-md-3">
          <label class="form-label">Per page</label>
          <select class="form-select" name="size" id="paginationSize" th:value="${size}">
			<option th:selected="${size== 10}" th:value="10">10</option>
            <option th:selected="${size== 25}" th:value="25">25</option>
            <option th:selected="${size== 50}" th:value="50">50</option>
          </select>
        </div>

        <div class="col-md-1">
          <!--<button class="btn btn-primary-theme w-100" type="button"  id="filterPopupBtn">
            <i class="bi bi-funnel me-1"></i>
          </button>-->

          <button class="btn btn-primary-theme"
                  type="button"
                  data-bs-toggle="modal"
                  data-bs-target="#filterModal"
                  style="font-size: 0.9rem;">
            <i class="bi bi-funnel me-1"></i> Filter
          </button>


        </div>
      </form>

      <!-- Card -->
      <div class="app-card p-0">
        <!-- Table -->
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
              <tr>
                <th class="table_header_theme" style="width:90px;">#</th>
                <th class="table_header_theme" style="width:140px;">ABS ID</th>
                <th class="table_header_theme">Student</th>
                <th class="table_header_theme" style="width:150px;">DOB</th>
                <th class="table_header_theme" style="width:150px;">Mobile</th>
                <th class="table_header_theme" style="width:220px;">Email</th>
                <th class="table_header_theme" style="width:120px;">Actions</th>
              </tr>
            </thead>

            <tbody th:if="${page != null}">
              <tr th:each="s, iStat : ${page.content}">
                <!-- Sr No based on page + index -->
                <td th:text="${page.number * page.size + iStat.index + 1}">1</td>

                <!-- ABS ID -->
                <td th:text="${s.absId != null ? s.absId : '-'}">ABS-000000</td>

                <!-- Name + maybe nationality -->
                <td>
                  <div class="fw-semibold" th:text="${s.fullName}">Student Name</div>
                  <div class="text-muted small"
                       th:text="${s.nationality != null ? s.nationality : ''}">
                    Indian
                  </div>
                </td>

                <!-- DOB -->
                <td th:text="${s.dob != null ? #temporals.format(s.dob, 'dd MMM yyyy') : ''}">
                  12 Oct 2005
                </td>

                <!-- Mobile -->
                <td th:text="${s.mobile != null ? s.mobile : '-'}">+91 98xxx xxxxx</td>

                <!-- Email -->
                <td th:text="${s.email != null ? s.email : '-'}">student@example.com</td>

                <!-- Actions -->
                <td>
                  <div class="btn-group btn-group-sm">
                    <!-- TODO: wire student details page when ready -->
                    <a th:href="@{|/students?id=${s.studentId}|}"
                       class="btn btn-outline-secondary"
                       title="View">
                      <i class="bi bi-eye"></i>
                    </a>
                  </div>
                </td>
              </tr>

              <!-- Empty state -->
              <tr th:if="${#lists.isEmpty(page.content)}">
                <td colspan="7" class="text-center py-5 text-muted">
                  <i class="bi bi-inbox fs-4 d-block mb-2"></i>
                  No students found for the applied filters.
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Pagination -->
        <div class="d-flex align-items-center justify-content-between p-3 border-top"
             th:if="${page != null}">
          <div class="text-muted small">
            <span th:text="${page.totalElements == 0 ? 0 : page.number * page.size + 1}"></span>
            â€“
            <span th:text="${page.number * page.size + page.numberOfElements}"></span>
            of
            <span th:text="${page.totalElements}">0</span>
          </div>
          <nav aria-label="Students pagination">
            <ul class="pagination mb-0">
              <!-- Prev -->
              <li class="page-item" th:classappend="${page.first} ? 'disabled'">
                <a class="page-link"
                   th:href="@{/studentlist(q=${q}, size=${size}, page=${page.number - 1})}"
                   aria-label="Previous">
                  <span aria-hidden="true">&laquo;</span>
                </a>
              </li>

              <!-- Page numbers -->
              <li class="page-item"
                  th:each="p : ${#numbers.sequence(0, page.totalPages - 1)}"
                  th:classappend="${p} == ${page.number} ? 'active'">
                <a class="page-link"
                   th:text="${p + 1}"
                   th:href="@{/studentlist(q=${q}, size=${size}, page=${p})}">1</a>
              </li>

              <!-- Next -->
              <li class="page-item" th:classappend="${page.last} ? 'disabled'">
                <a class="page-link"
                   th:href="@{/studentlist(q=${q}, size=${size}, page=${page.number + 1})}"
                   aria-label="Next">
                  <span aria-hidden="true">&raquo;</span>
                </a>
              </li>
            </ul>
          </nav>
        </div>
      </div>

    </div>
  </div>


  <!-- Filter Modal -->
  <div class="modal fade" id="filterModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">

        <div class="modal-header">
          <h5 class="modal-title">Apply Filters</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">
          <form id="filterForm">
            <div class="row g-3">

              <!-- Course -->
              <div class="col-md-6">
                <div class="form-floating">
                  <select class="form-select" id="course">
                    <option value="">All Courses</option>
                    <option value="BCA">BCA</option>
                    <option value="MCA">MCA</option>
                    <option value="MBA">MBA</option>
                  </select>
                  <label>Course</label>
                </div>
              </div>

              <!-- Batch -->
              <div class="col-md-6">
                <div class="form-floating">
                  <select class="form-select" id="batch">
                    <option value="">All Batches</option>
                    <option value="2022">2022</option>
                    <option value="2023">2023</option>
                    <option value="2024">2024</option>
                  </select>
                  <label>Batch</label>
                </div>
              </div>

              <!-- Year -->
              <div class="col-md-6">
                <div class="form-floating">
                  <select class="form-select" id="year">
                    <option value="">All Years</option>
                    <option value="1">1st Year</option>
                    <option value="2">2nd Year</option>
                    <option value="3">3rd Year</option>
                  </select>
                  <label>Year</label>
                </div>
              </div>

              <!-- Gender -->
              <div class="col-md-6">
                <div class="form-floating">
                  <select class="form-select" id="gender">
                    <option value="">All Genders</option>
                    <option value="MALE">Male</option>
                    <option value="FEMALE">Female</option>
                  </select>
                  <label>Gender</label>
                </div>
              </div>

            </div>
          </form>
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button class="btn btn-primary" id="applyFilterBtn" onclick="applyFilters()">
            <i class="bi bi-check-circle me-1"></i> Apply
          </button>
        </div>

      </div>
    </div>
  </div>




  <!-- Icons + Bootstrap JS (if not already in common_head) -->
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Optional: sidebar drawer helper (same as your admission page if needed) -->
  <div id="sbOverlay" class="sb-overlay" hidden></div>

  <style>
    :root { --sbw: 260px; }
    @media (max-width: 991.98px) { :root { --sbw: 0px; } }
    body.has-sidebar .app-main-wrap { margin-left: var(--sbw); transition: margin-left .2s ease; }
    .app-card {
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 10px;
      box-shadow: 0 6px 18px rgba(2,6,23,.06);
    }
  </style>
  <script src="js/admission.js"></script>
</body>
</html>
