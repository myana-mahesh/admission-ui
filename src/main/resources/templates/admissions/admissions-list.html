<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/html-header :: common_head"></head>
<body class="theme-light has-sidebar">

  <!-- Left sidebar (drop-in) -->
  <div th:replace="fragments/sidebar :: app_sidebar(active='admissions')"></div>

  <!-- Content wrapper (reserves left space on desktop) -->
  <div class="app-main-wrap">
    <div class="container-xl py-3 max-width-100">

      <!-- Header -->
      <div class="d-flex align-items-center justify-content-between mb-3">
        <div>
          <h3 class="mb-0">Admissions</h3>
        </div>
      </div>

      <!-- Filters / Toolbar -->
      <form class="row g-2 align-items-end justify-content-between mb-3" method="get" th:action="@{/admissionlist}">
        <!-- keyword search -->
        <div class="col-md-5">
          <label class="form-label">Search</label>
          <input type="text" class="form-control" name="q" placeholder="ABS ID / Student name / Mobile / Course / Year" th:value="${q}">
        </div>

        <!-- status fixed to Pending & Success -->
        <div class="col-md-3">
          <label class="form-label">Status</label>
          <div class="d-flex gap-2">
            <select class="form-select" name="status" th:value="${statusSelected}">
				<option value=""> Select Status </option>
              <option value="PENDING" th:selected="${statusSelected eq 'PENDING'}"> PENDING </option>
              <option value="ADMITTED" th:selected="${statusSelected eq 'ADMITTED'}"> ADMITTED </option>
              <option value="REJECTED" th:selected="${statusSelected eq 'REJECTED'}"> REJECTED </option>
              <option value="UNDER_CANCELLATION" th:selected="${statusSelected eq 'UNDER_CANCELLATION'}"> UNDER CANCELLATION </option>
            </select>
          </div>
        </div>

        <!-- page size -->
        <div class="col-md-2">
          <label class="form-label">Per page</label>
          <select class="form-select"  name="size" id="paginationSize" th:value="${size}">
            <option th:selected="${size== 10}" th:value="10">10</option>
            <option th:selected="${size== 25}" th:value="25">25</option>
            <option th:selected="${size== 50}" th:value="50">50</option>
          </select>
        </div>

        <div class="col-md-1">
          <button class="btn btn-primary-theme w-100" type="submit">
            <i class="bi bi-funnel me-1"></i> 
          </button>
        </div>
      </form>

      <!-- Card -->
      <div class="app-card p-0">
        <!-- Table -->
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
              <tr>
                <th class="table_header_theme" style="width:140px;">ABS ID</th>
                <th class="table_header_theme" >Student</th>
                <th class="table_header_theme"  style="width:220px;">Course</th>
                <th class="table_header_theme"  style="width:160px;">Date</th>
                <th class="table_header_theme"  style="width:120px;">Status</th>
                <th class="table_header_theme"  style="width:120px;">Actions</th>
              </tr>
            </thead>
            <tbody th:if="${page!=null}">
              <tr th:each="a,iStat: ${page.content}">
                <td>
                  <a th:href="@{|/admissions?id=${a.admissionId}|}" class="text-decoration-none fw-semibold" th:text="${iStat.index+1}">ABS-000000</a>
                </td>
                <td>
                  <div class="fw-semibold" th:text="${a.student.fullName}">Student Name</div>
                  <div class="text-muted small" th:text="${a.student.mobile}">+91 98xxx xxxxx</div>
                </td>
                <td th:text="${a.course.name}">D.Pharm</td>
                <!-- Prefer Date of Admission; fallback to created date if you expose it -->
                <td th:text="${a.createdAt != null ? #temporals.format(a.createdAt, 'dd MMM yyyy') : ''}">12 Oct 2025</td>
                <td>
                  <span th:switch="${a.status}">
                    <span th:case="${T(com.impactsure.sanctionui.enums.AdmissionStatus).ADMITTED}" class="badge bg-success-subtle text-success-emphasis border border-success-subtle" th:text="${a.status}"></span>
                    <span th:case="*{T(com.impactsure.sanctionui.enums.AdmissionStatus).PENDING}" class="badge pending bg-success-warning text-warning-emphasis border border-warning-subtle" th:text="${a.status}"></span>
					<span th:case="*{T(com.impactsure.sanctionui.enums.AdmissionStatus).REJECTED}" class="badge pending bg-success-warning text-warning-emphasis border border-warning-subtle" th:text="${a.status}"></span>
                    <span th:case="*" class="badge pending text-secondary-emphasis border border-secondary-subtle" th:if="${a.status!='ADMITTED'}" th:text="${a.status}">Other</span>
                  </span>
                </td>
                <td>
                  <div class="btn-group btn-group-sm">
                    <a th:href="@{|/admissions?id=${a.admissionId}|}" class="btn btn-outline-secondary" title="View">
                      <i class="bi bi-eye"></i>
                    </a>
                  </div>
                </td>
              </tr>
              <!-- Empty state -->
              <tr th:if="${#lists.isEmpty(page.content)}">
                <td colspan="6" class="text-center py-5 text-muted">
                  <i class="bi bi-inbox fs-4 d-block mb-2"></i> No admissions found for the applied filters.
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Pagination -->
        <div class="d-flex align-items-center justify-content-between p-3 border-top" th:if="${page!=null}">
          <div class="text-muted small">
            <span th:text="${page.totalElements == 0 ? 0 : page.number * page.size + 1}"></span> â€“ <span th:text="${page.number * page.size + page.numberOfElements}"></span> of <span th:text="${page.totalElements}">0</span>
          </div>
          <nav aria-label="Admissions pagination">
            <ul class="pagination mb-0">
              <!-- Prev -->
              <li class="page-item" th:classappend="${page.first} ? 'disabled'">
                <a class="page-link" th:href="@{/admissionlist(q=${q}, status=${'PENDING,SUCCESS'}, size=${size}, page=${page.number-1})}" aria-label="Previous">
                  <span aria-hidden="true">&laquo;</span>
                </a>
              </li>
              <!-- Page numbers -->
              <li class="page-item" th:each="p : ${#numbers.sequence(0, page.totalPages-1)}" th:classappend="${p}==${page.number} ? 'active'">
                <a class="page-link" th:text="${p+1}" th:href="@{/admissionlist(q=${q}, status=${'PENDING,SUCCESS'}, size=${size}, page=${p})}">1</a>
              </li>
              <!-- Next -->
              <li class="page-item" th:classappend="${page.last} ? 'disabled'">
                <a class="page-link" th:href="@{/admissionlist(q=${q}, status=${'PENDING,SUCCESS'}, size=${size}, page=${page.number+1})}" aria-label="Next">
                  <span aria-hidden="true">&raquo;</span>
                </a>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </div>
  </div>

  <!-- Optional: icon font if not already included -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <!-- Bootstrap JS (if not in common head) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Sidebar mobile overlay (optional) -->
  <div id="sbOverlay" class="sb-overlay" hidden></div>

  <script>
    // Drawer helper (works if you have a button#sbToggle somewhere)
    (function () {
      const sb = document.getElementById('appSidebar');
      const btn = document.getElementById('sbToggle');
      const overlay = document.getElementById('sbOverlay');
      if (!sb || !btn || !overlay) return;
      const open = () => {
        sb.classList.add('is-open');
        overlay.hidden = false;
        btn.setAttribute('aria-expanded', 'true');
      };
      const close = () => {
        sb.classList.remove('is-open');
        overlay.hidden = true;
        btn.setAttribute('aria-expanded', 'false');
      };
      btn.addEventListener('click', () => sb.classList.contains('is-open') ? close() : open());
      overlay.addEventListener('click', close);
      document.addEventListener('keydown', e => { if (e.key === 'Escape') close(); });
    }());
  </script>

  <!-- Reserve space for sidebar (same shim we used earlier) -->
  <style>
    :root { --sbw: 260px; }
    @media (max-width: 991.98px) { :root { --sbw: 0px; } }
    body.has-sidebar .app-main-wrap { margin-left: var(--sbw); transition: margin-left .2s ease; }
    @media (min-width: 992px) { .sb-spacer { display: none; } }
    .app-card { background: #fff; border: 1px solid #e5e7eb; border-radius: 10px; box-shadow: 0 6px 18px rgba(2,6,23,.06); }
  </style>
</body>
</html>
